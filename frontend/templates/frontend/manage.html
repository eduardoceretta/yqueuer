{% extends 'frontend/base.html' %}
{% load static %}

{% block body_block %}
  <script src="{% static "javascript/dev_jquery-3.1.1.js" %}"></script>

  <div id="add_channel">
    <span>
      Add Channel:
      <input id="add_channel_channel" type="text" name="channel_name" placeholder="Channel Name">
      <button id="add_channel_submit"> Submit </button>
      <span id="add_channel_result"></span>
    </span>
  </div>
  <div id="update_channel_library">
    <span>
      Update Channel Library:
      <input id="update_channel_library_channel" type="text" name="channel_name" placeholder="Channel Name">
      <button id="update_channel_library_submit"> Submit </button>
      <span id="update_channel_library_result"></span>
    </span>
  </div>
  <div id="bulk_mark">
    <span>
      Mark videos as watched:
      <input id="bulk_mark_channel" type="text" name="channel_name" placeholder="Channel Name">
      <input id="bulk_mark_until_y_video_id" type="text" name="until_y_video_id" placeholder="Until Video ID">
      <button id="bulk_mark_submit"> Submit </button>
      <span id="bulk_mark_result"></span>
    </span>
  </div>


  <script type="text/javascript">
    function log() {
      console.log('_Y_',arguments);
    }

    $( document ).ready(function() {
      log( "manage ready!" );
      var bulk_mark = {
        'div' : $("#bulk_mark"),
        'channel_name' : $("#bulk_mark_channel"),
        'until_y_video_id' : $("#bulk_mark_until_y_video_id"),
        'submit' : $("#bulk_mark_submit"),
        'result' : $("#bulk_mark_result"),
      };
      bulk_mark.submit.on('click', function(e) {
        log ('bulk_mark.submit');
        log(bulk_mark.channel_name.val());
        log(bulk_mark.until_y_video_id.val());
        var channel_name = bulk_mark.channel_name.val();
        var until_y_video_id = bulk_mark.until_y_video_id.val();
        bulk_mark.result.text('processing...');
        bulk_mark.div.find(":input").attr("disabled", true);
        $.ajax({
          method: "POST",
          url: "/api/bulk_mark_watched/",
          headers: {'X-CSRFToken': '{{ csrf_token }}'},
          data: { 'channel_name' : channel_name,
                  'until_y_video_id': until_y_video_id,
          },
          success: function(result){
            bulk_mark.div.find(":input").attr("disabled", false);
            if(result.success) {
              bulk_mark.result.text('success: marked ' + result.data.marked + ' videos');
            } else if(result.error) {
              bulk_mark.result.text('error: ' + result.error);
            }
          },
          error: function(xhr,status,error){
            log('bulk_mark','error', xhr,status,error);
            bulk_mark.div.find(":input").attr("disabled", false);
            bulk_mark.result.text('error');
          }
        });
      });

      var add_channel = {
        'div' : $("#add_channel"),
        'channel_name' : $("#add_channel_channel"),
        'submit' : $("#add_channel_submit"),
        'result' : $("#add_channel_result"),
      }
      add_channel.submit.on('click', function(e) {
        log ('add_channel.submit');
        log(add_channel.channel_name.val());
        var channel_name = add_channel.channel_name.val();
        add_channel.result.text('processing...');
        add_channel.div.find(":input").attr("disabled", true);
        $.ajax({
          method: "POST",
          url: "/api/add_channel/",
          headers: {'X-CSRFToken': '{{ csrf_token }}'},
          data: { 'channel_name' : channel_name },
          success: function(result){
            add_channel.div.find(":input").attr("disabled", false);
            if(result.success) {
              add_channel.result.text('success');
            } else if(result.error) {
              add_channel.result.text('error: ' + result.error);
            }
          },
          error: function(xhr,status,error){
            log('add_channel','error', xhr,status,error);
            add_channel.div.find(":input").attr("disabled", false);
            add_channel.result.text('error');
          }
        });
      });

      var update_channel_library = {
        'div' : $("#update_channel_library"),
        'channel_name' : $("#update_channel_library_channel"),
        'submit' : $("#update_channel_library_submit"),
        'result' : $("#update_channel_library_result"),
      }
      update_channel_library.submit.on('click', function(e) {
        log ('update_channel_library.submit');
        log(update_channel_library.channel_name.val());
        var channel_name = update_channel_library.channel_name.val();
        update_channel_library.result.text('processing...');
        update_channel_library.div.find(":input").attr("disabled", true);
        $.ajax({
          method: "POST",
          url: "/api/update_channel_library/",
          headers: {'X-CSRFToken': '{{ csrf_token }}'},
          data: { 'channel_name' : channel_name },
          success: function(result){
            update_channel_library.div.find(":input").attr("disabled", false);
            if(result.success) {
              update_channel_library.result.text('success');
            } else if(result.error) {
              update_channel_library.result.text('error: ' + result.error);
            }
          },
          error: function(xhr,status,error){
            log('update_channel_library','error', xhr,status,error);
            update_channel_library.div.find(":input").attr("disabled", false);
            update_channel_library.result.text('error');
          }
        });
      });

    });
  </script>
{% endblock %}